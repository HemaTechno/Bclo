<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>عرض السكربت</title>
  <meta name="description" content="عرض سكربت Roblox بشكل أنيق وقابل للتحميل" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Cairo', sans-serif; }
    .fade-in { animation: fadeIn 0.8s ease-in-out; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    pre {
      white-space: pre-wrap;
      word-break: break-word;
      background-color: #f9fafb;
      border-radius: 10px;
      padding: 1rem;
      direction: ltr;
    }
    .warning {
      background-color: #fef3c7;
      color: #b45309;
      padding: 10px;
      border-radius: 8px;
      font-weight: bold;
      margin-bottom: 1rem;
    }
  </style>
</head>
<body class="bg-gradient-to-tr from-white to-blue-100 min-h-screen flex items-center justify-center px-4">

  <div class="bg-white p-8 rounded-3xl shadow-2xl w-full max-w-3xl fade-in">
    <div id="scriptContainer" class="space-y-6 text-gray-800">
      <p class="text-center text-gray-500">...جاري تحميل البيانات</p>
    </div>

    <div class="flex justify-between mt-6">
      <button onclick="history.back()" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">🔙 رجوع</button>
      <button id="downloadBtn" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700" disabled>💾 تحميل السكربت</button>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    // إعدادات Firebase الخاصة بمشروعك (غيرها بإعدادات مشروعك)
    const firebaseConfig = {
  apiKey: "AIzaSyBoPJbx5v6EkOqxOJkbhzHqIJdAByh79Rg",
  authDomain: "hhhhhh-d4fb8.firebaseapp.com",
  projectId: "hhhhhh-d4fb8",
  storageBucket: "hhhhhh-d4fb8.appspot.com",
  messagingSenderId: "24512338206",
  appId: "1:24512338206:web:dfe045db59bd3434a2110f",
  measurementId: "G-HD4R7GNQ5H"
};

    // تهيئة Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const params = new URLSearchParams(window.location.search);
    const scriptId = params.get("id");

    const container = document.getElementById("scriptContainer");
    const downloadBtn = document.getElementById("downloadBtn");

    if (!scriptId) {
      container.innerHTML = `<p class="text-center text-red-500 font-bold">❌ لم يتم تحديد معرف السكربت</p>`;
      document.title = "خطأ";
      downloadBtn.disabled = true;
    } else {
      // جلب السكربت من Firestore
      db.collection("scripts").doc(scriptId).get()
        .then(doc => {
          if (!doc.exists) {
            container.innerHTML = `<p class="text-center text-red-500 font-bold">❌ لم يتم العثور على السكربت</p>`;
            document.title = "سكربت غير موجود";
            downloadBtn.disabled = true;
            return;
          }

          const data = doc.data();
          document.title = data.name || "عرض السكربت";

          container.innerHTML = `
            <h1 class="text-3xl font-bold text-blue-700">${data.name}</h1>
            <p class="text-gray-700">${data.desc}</p>
            <p class="text-sm text-gray-500">📍 الماب: <b>${data.map}</b></p>
            <img src="${data.image}" alt="صورة السكربت" class="rounded-lg w-full max-h-72 object-cover mt-4 shadow" />

            <div class="warning">⚠️ لا تقم بمشاركة السكربت مع أشخاص مجهولين</div>

            <pre id="codeBlock">${data.code}</pre>
          `;
          downloadBtn.disabled = false;

          // زر تحميل السكربت
          downloadBtn.onclick = () => {
            const blob = new Blob([data.code], { type: "text/plain" });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = `${data.name}.txt`;
            link.click();
          };

          // تحذير عند النسخ داخل صندوق الكود
          document.addEventListener("copy", (e) => {
            if (document.activeElement.id === "codeBlock") {
              alert("⚠️ تذكير: تأكد أنك تستخدم السكربت على مسؤوليتك الخاصة.");
            }
          });
        })
        .catch(error => {
          container.innerHTML = `<p class="text-center text-red-500 font-bold">❌ حدث خطأ أثناء تحميل السكربت</p>`;
          console.error("Firestore error:", error);
          downloadBtn.disabled = true;
          document.title = "خطأ في التحميل";
        });
    }
  </script>
</body>
</html>
