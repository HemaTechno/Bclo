<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <script type="module" src="notification.js"></script>
    <script type="module" src="maintenance-check.js"></script>

    <meta charset="UTF-8" />
    <title>عرض السكربت | ScriptBot - تنزيل سكربت Roblox مجاناً</title>
    <meta name="description" content="عرض وتحميل سكربت Roblox كاملاً مع كود التنفيذ. دعم مباشر، نسخ سهل، وتحميل فوري." />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    
    <!-- Open Graph Tags -->
    <meta property="og:title" content="عرض السكربت | ScriptBot - تنزيل سكربت Roblox مجاناً" />
    <meta property="og:description" content="عرض وتحميل سكربت Roblox كاملاً مع كود التنفيذ." />
    <meta property="og:image" content="https://scriptbot.cloud/assets/script-detail-banner.png" />
    <meta property="og:url" content="https://scriptbot.cloud/script-view.html" />
    <meta property="og:type" content="website" />
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="عرض السكربت | ScriptBot" />
    <meta name="twitter:description" content="تحميل سكربت Roblox مجاناً مع كود التنفيذ الكامل." />
    
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    
    <style>
        :root {
            --glass-bg: rgba(255, 255, 255, 0.15);
            --glass-border: rgba(255, 255, 255, 0.25);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            --warning-gradient: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            --danger-gradient: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            --like-gradient: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
            --star-gradient: linear-gradient(135deg, #fbbf24 0%, #d97706 100%);
        }
        
        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #f0f4ff 0%, #e6f0ff 100%);
            min-height: 100vh;
            margin: 0;
            padding: 0;
            direction: rtl;
            overflow-x: hidden;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(102, 126, 234, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(118, 75, 162, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(240, 147, 251, 0.05) 0%, transparent 50%);
            z-index: -1;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 
                0 15px 35px rgba(0, 0, 0, 0.1),
                0 5px 15px rgba(0, 0, 0, 0.07),
                inset 0 0 0 1px rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            position: relative;
            overflow: hidden;
        }
        
        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.4) 0%, rgba(255, 255, 255, 0.1) 100%);
            z-index: -1;
            border-radius: inherit;
        }
        
        .glass-input {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 
                0 4px 6px rgba(0, 0, 0, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
        }
        
        .gradient-text {
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .gradient-bg {
            background: var(--primary-gradient);
            border: none;
            box-shadow: 
                0 4px 15px rgba(102, 126, 234, 0.4),
                0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .secondary-gradient-bg {
            background: var(--secondary-gradient);
            border: none;
            box-shadow: 
                0 4px 15px rgba(240, 147, 251, 0.4),
                0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .success-gradient-bg {
            background: var(--success-gradient);
            border: none;
            box-shadow: 
                0 4px 15px rgba(34, 197, 94, 0.4),
                0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .warning-gradient-bg {
            background: var(--warning-gradient);
            border: none;
            box-shadow: 
                0 4px 15px rgba(245, 158, 11, 0.4),
                0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .danger-gradient-bg {
            background: var(--danger-gradient);
            border: none;
            box-shadow: 
                0 4px 15px rgba(239, 68, 68, 0.4),
                0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .like-gradient-bg {
            background: var(--like-gradient);
            border: none;
            box-shadow: 
                0 4px 15px rgba(236, 72, 153, 0.4),
                0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .star-gradient-bg {
            background: var(--star-gradient);
            border: none;
            box-shadow: 
                0 4px 15px rgba(251, 191, 36, 0.4),
                0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .btn-glow {
            box-shadow: 
                0 4px 15px rgba(102, 126, 234, 0.3),
                0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .btn-glow:hover {
            box-shadow: 
                0 6px 25px rgba(102, 126, 234, 0.5),
                0 4px 6px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .btn-like-glow {
            box-shadow: 
                0 4px 15px rgba(236, 72, 153, 0.3),
                0 2px 4px rgba(0, 0, 0, 0.1);
       color: #ec4899;
        }
        
        .btn-like-glow:hover {
            box-shadow: 
                0 6px 25px rgba(236, 72, 153, 0.5),
                0 4px 6px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .btn-star-glow {
            box-shadow: 
                0 4px 15px rgba(251, 191, 36, 0.3),
                0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .btn-star-glow:hover {
            box-shadow: 
                0 6px 25px rgba(251, 191, 36, 0.5),
                0 4px 6px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .script-badge {
            background: linear-gradient(135deg, #FF416C 0%, #FF4B2B 100%);
            color: white;
            font-size: 12px;
            padding: 4px 12px;
            border-radius: 12px;
            font-weight: bold;
            box-shadow: 
                0 4px 10px rgba(255, 65, 108, 0.4),
                0 2px 4px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .script-header {
                padding: 1rem !important;
            }
            
            .script-image {
                height: 200px !important;
            }
            
            .code-container {
                padding: 1rem !important;
            }
            
            .action-buttons {
                flex-direction: column !important;
                gap: 0.75rem !important;
            }
            
            .action-button {
                width: 100% !important;
            }
            
            .rating-section {
                flex-direction: column !important;
            }
            
            .like-section {
                flex-direction: column !important;
                align-items: flex-start !important;
            }
        }
        
        @media (max-width: 480px) {
            .script-title {
                font-size: 1.75rem !important;
            }
            
            .stats-grid {
                grid-template-columns: 1fr !important;
            }
        }
        
        /* Code block styling */
        .code-container {
            position: relative;
            border-radius: 16px;
            overflow: hidden;
        }
        
        .code-header {
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(10px);
            padding: 0.75rem 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .code-content {
            background: #1e293b;
            color: #f8fafc;
            padding: 1.5rem;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Cascadia Code', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            direction: ltr;
            white-space: pre-wrap;
            word-break: break-word;
        }
        
        /* Custom scrollbar for code */
        .code-content::-webkit-scrollbar {
            width: 8px;
        }
        
        .code-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        
        .code-content::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
        }
        
        /* Rating stars */
        .rating-stars {
            display: flex;
            flex-direction: row-reverse;
            justify-content: flex-end;
        }
        
        .rating-stars input {
            display: none;
        }
        
        .rating-stars label {
            cursor: pointer;
            font-size: 24px;
            color: #d1d5db;
            transition: all 0.2s ease;
            margin-left: 4px;
        }
        
        .rating-stars input:checked ~ label,
        .rating-stars label:hover,
        .rating-stars label:hover ~ label {
            color: #fbbf24;
        }
        
        .rating-stars input:checked + label {
            animation: starPulse 0.5s ease-in-out;
        }
        
        @keyframes starPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        /* Like button animation */
        .like-button {
            transition: all 0.3s ease;
        }
        
        .like-button.liked {
            animation: likePulse 0.5s ease-in-out;
        }
        
        @keyframes likePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(10px) scale(0.98); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .floating {
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .pulse {
            animation: pulse 2s ease-in-out infinite;
        }
        
        /* Copy success animation */
        @keyframes copySuccess {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .copy-success {
            animation: copySuccess 0.3s ease-out;
        }
        
        /* Shine effect */
        .shine-effect {
            position: relative;
            overflow: hidden;
        }
        
        .shine-effect::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                to right,
                rgba(255, 255, 255, 0) 0%,
                rgba(255, 255, 255, 0.3) 50%,
                rgba(255, 255, 255, 0) 100%
            );
            transform: rotate(30deg);
            transition: transform 0.6s;
        }
        
        .shine-effect:hover::after {
            transform: rotate(30deg) translate(100%, 100%);
        }
        
        /* Game badge */
        .game-badge {
            display: inline-flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 12px;
            padding: 6px 12px;
            font-size: 14px;
            font-weight: 600;
        }
        
        /* Toast notification */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateX(150%);
            transition: transform 0.3s ease-out;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast.success {
            border-right: 4px solid #22c55e;
        }
        
        .toast.error {
            border-right: 4px solid #ef4444;
        }
        
        .toast.warning {
            border-right: 4px solid #f59e0b;
        }
        
        .toast.info {
            border-right: 4px solid #3b82f6;
        }
        
        /* Loading overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        /* Tag styling */
        .script-tag {
            display: inline-block;
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 500;
            margin: 2px;
        }
        
        /* Rating progress bar */
        .rating-progress {
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
            margin: 8px 0;
        }
        
        .rating-progress-bar {
            height: 100%;
            background: var(--star-gradient);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        /* Rating summary */
        .rating-summary {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .average-rating {
            text-align: center;
        }
        
        .rating-number {
            font-size: 36px;
            font-weight: bold;
            background: var(--star-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* User rating indicator */
        .user-rating {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: rgba(251, 191, 36, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(251, 191, 36, 0.2);
        }
        
        /* Like count with animation */
        .like-count {
            transition: all 0.3s ease;
        }
        
        .like-count.changed {
            animation: countChange 0.5s ease-in-out;
        }
        
        @keyframes countChange {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        /* Rating distribution */
        .rating-distribution {
            flex: 1;
        }
        
        .rating-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }
        
        .rating-star {
            color: #fbbf24;
            font-size: 14px;
        }
        
        .rating-count {
            min-width: 30px;
            text-align: left;
            font-size: 14px;
            color: #6b7280;
        }
    </style>
</head>
<body class="text-gray-800 min-h-screen">

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="mb-4">
            <div class="w-16 h-16 rounded-full border-4 border-blue-200 border-t-blue-600 animate-spin"></div>
        </div>
        <p class="text-gray-600 text-lg font-medium">جارٍ تحميل السكربت...</p>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast glass-card">
        <i id="toast-icon" class="fas fa-check-circle text-green-500"></i>
        <span id="toast-message" class="text-gray-700">تم نسخ السكربت بنجاح!</span>
    </div>

    <!-- Header -->
    <header class="sticky top-0 z-50 p-4">
        <div class="container mx-auto">
            <div class="glass-card p-4 flex justify-between items-center">
                <div class="flex items-center space-x-3 space-x-reverse">
                    <a href="index.html" class="flex items-center space-x-3 space-x-reverse">
                        <div class="relative">
                            <div class="w-10 h-10 md:w-12 md:h-12 rounded-xl overflow-hidden bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center">
                                <i class="fas fa-code text-white text-xl"></i>
                            </div>
                            <div class="absolute -top-1 -right-1 w-3 h-3 md:w-4 md:h-4 bg-green-500 rounded-full border-2 border-white"></div>
                        </div>
                        <div>
                            <h1 class="text-xl md:text-2xl font-bold gradient-text">ScriptBot<span class="text-blue-600">.cloud</span></h1>
                            <p class="text-xs text-gray-500 hidden md:block">سكربتات روبلوكس مجانية وآمنة</p>
                        </div>
                    </a>
                </div>
                
                <!-- Back Button -->
                <button id="back-button" class="glass-input text-blue-600 px-4 md:px-5 py-2 rounded-xl font-medium hover:bg-white transition flex items-center">
                    <i class="fas fa-arrow-left ml-2"></i>
                    <span class="hidden md:inline">رجوع للقائمة</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Script Header -->
        <div id="script-header" class="glass-card p-6 md:p-8 mb-8 fade-in hidden">
            <div class="flex flex-col lg:flex-row gap-6">
                <!-- Script Image -->
                <div class="lg:w-1/3">
                    <div id="script-image-container" class="rounded-2xl overflow-hidden shadow-lg">
                        <img id="script-image" class="w-full h-64 object-cover" src="" alt="صورة السكربت">
                    </div>
                </div>
                
                <!-- Script Info -->
                <div class="lg:w-2/3">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h1 id="script-title" class="text-2xl md:text-3xl font-bold text-gray-800 mb-2 script-title"></h1>
                            <div id="script-badges" class="flex flex-wrap gap-2 mb-3">
                                <!-- Badges will be added here -->
                            </div>
                        </div>
                        <div id="script-actions" class="flex gap-2">
                            <!-- Quick actions will be added here -->
                        </div>
                    </div>
                    
                    <p id="script-description" class="text-gray-600 mb-4 text-base md:text-lg"></p>
                    
                    <!-- Game Info -->
                    <div class="mb-6">
                        <div class="flex items-center gap-4 flex-wrap">
                            <span id="game-badge" class="game-badge">
                                <i class="fas fa-gamepad ml-2"></i>
                                <span id="game-name">جارٍ التحميل...</span>
                            </span>
                            <span id="publisher-info" class="text-sm text-gray-500">
                                <i class="fas fa-user-edit ml-1"></i>
                                <span>الناشر: </span>
                                <span id="publisher-name">جارٍ التحميل...</span>
                            </span>
                            <span id="date-info" class="text-sm text-gray-500">
                                <i class="fas fa-calendar-alt ml-1"></i>
                                <span id="script-date">تاريخ النشر: </span>
                            </span>
                        </div>
                    </div>
                    
                    <!-- Tags -->
                    <div id="tags-container" class="mb-6">
                        <div class="flex flex-wrap gap-2">
                            <!-- Tags will be added here -->
                        </div>
                    </div>
                    
                    <!-- Stats Grid -->
                    <div id="stats-grid" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6 stats-grid">
                        <!-- Stats will be added here -->
                    </div>
                    
                    <!-- Rating and Like Section -->
                    <div id="interaction-section" class="glass-card p-6 mb-6 hidden">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6 rating-section">
                            <!-- Rating Section -->
                            <div class="flex-1">
                                <h3 class="font-bold text-lg text-gray-800 mb-3 flex items-center">
                                    <i class="fas fa-star text-yellow-500 ml-2"></i>
                                    تقييم السكربت
                                </h3>
                                
                                <div class="rating-summary mb-4">
                                    <div class="average-rating">
                                        <div id="average-rating" class="rating-number">0.0</div>
                                        <div class="text-sm text-gray-500">من 5.0</div>
                                    </div>
                                    
                                    <div class="rating-distribution">
                                        <div id="rating-distribution">
                                            <!-- Rating distribution will be added here -->
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- User Rating -->
                                <div id="user-rating-section" class="mb-4">
                                    <p class="text-sm text-gray-600 mb-2">تقييمك:</p>
                                    <div class="rating-stars" id="rating-stars">
                                        <input type="radio" id="star5" name="rating" value="5">
                                        <label for="star5" title="ممتاز">★</label>
                                        <input type="radio" id="star4" name="rating" value="4">
                                        <label for="star4" title="جيد جداً">★</label>
                                        <input type="radio" id="star3" name="rating" value="3">
                                        <label for="star3" title="جيد">★</label>
                                        <input type="radio" id="star2" name="rating" value="2">
                                        <label for="star2" title="مقبول">★</label>
                                        <input type="radio" id="star1" name="rating" value="1">
                                        <label for="star1" title="سيء">★</label>
                                    </div>
                                    <div id="user-rating-indicator" class="user-rating mt-3 hidden">
                                        <span class="text-sm font-medium text-yellow-700">تقييمك: </span>
                                        <div class="flex">
                                            <span id="user-rating-value" class="font-bold text-yellow-600"></span>
                                            <i class="fas fa-star text-yellow-500 mr-1"></i>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="text-xs text-gray-500">
                                    <i class="fas fa-users ml-1"></i>
                                    <span id="total-ratings">0</span> تقييم
                                </div>
                            </div>
                            
                            <!-- Like Section -->
                            <div class="flex-1">
                                <h3 class="font-bold text-lg text-gray-800 mb-3 flex items-center">
                                    <i class="fas fa-heart text-pink-500 ml-2"></i>
                                    أعجبك السكربت؟
                                </h3>
                                
                                <div class="flex flex-col sm:flex-row items-start sm:items-center gap-4 like-section">
                                    <button id="like-button" class="like-gradient-bg text-white px-6 py-3 rounded-xl font-medium btn-like-glow flex items-center justify-center gap-2 like-button">
                                        <i id="like-icon" class="fas fa-heart"></i>
                                        <span id="like-text">أعجبني</span>
                                    </button>
                                    
                                    <div class="flex items-center gap-3">
                                        <div class="text-center">
                                            <div id="like-count" class="text-2xl font-bold text-gray-800 like-count">0</div>
                                            <div class="text-sm text-gray-500">إعجاب</div>
                                        </div>
                                        
                                        <div class="text-center">
                                            <div id="dislike-count" class="text-2xl font-bold text-gray-800">0</div>
                                            <div class="text-sm text-gray-500">عدم إعجاب</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-4">
                                    <button id="dislike-button" class="glass-input text-gray-600 px-4 py-2 rounded-lg hover:bg-gray-100 transition flex items-center gap-2 text-sm">
                                        <i id="dislike-icon" class="fas fa-thumbs-down"></i>
                                        <span>لم يعجبني</span>
                                    </button>
                                </div>
                                
                                <p class="text-xs text-gray-500 mt-3">
                                    شارك رأيك لتحسين جودة السكربتات
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Warning Alert -->
                    <div id="warning-alert" class="glass-card bg-orange-50/50 border-orange-200 p-4 rounded-xl mb-6">
                        <div class="flex items-start">
                            <i class="fas fa-exclamation-triangle text-orange-500 text-xl ml-3 mt-1"></i>
                            <div>
                                <h4 class="font-bold text-orange-700 mb-1">تحذير مهم</h4>
                                <p class="text-orange-600 text-sm">استخدم السكربت بحذر ومسؤولية. لا تتحمل الإدارة أي مسؤولية عن سوء الاستخدام. تأكد من استخدام سكربتات آمنة فقط.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Code Section -->
        <div id="code-section" class="glass-card mb-8 fade-in hidden">
            <div class="code-header">
                <div class="flex items-center gap-3">
                    <i class="fas fa-code text-blue-400"></i>
                    <span class="text-white font-medium">كود السكربت</span>
                    <span id="code-length" class="text-gray-400 text-sm">(0 حرف)</span>
                </div>
                <div class="flex items-center gap-2">
                    <button id="copy-all-btn" class="glass-input text-white px-3 py-1 rounded-lg text-sm hover:bg-white/20 transition flex items-center">
                        <i class="fas fa-copy ml-1"></i>
                        نسخ الكل
                    </button>
                    <button id="toggle-code-btn" class="glass-input text-white px-3 py-1 rounded-lg text-sm hover:bg-white/20 transition flex items-center">
                        <i id="toggle-icon" class="fas fa-expand ml-1"></i>
                        <span id="toggle-text">تكبير</span>
                    </button>
                </div>
            </div>
            <div class="code-content" id="code-content">
                <!-- Code will be loaded here -->
                <div class="text-center py-8">
                    <div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500 mb-4"></div>
                    <p class="text-gray-400">جارٍ تحميل كود السكربت...</p>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div id="action-buttons" class="glass-card p-6 mb-8 fade-in hidden">
            <h3 class="text-xl font-bold text-gray-800 mb-4">تحميل واستخدام السكربت</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 action-buttons">
                <!-- Buttons will be added here -->
            </div>
            
            <!-- Instructions -->
            <div class="mt-8 p-4 rounded-xl bg-blue-50/50 border border-blue-200">
                <h4 class="font-bold text-blue-700 mb-2 flex items-center">
                    <i class="fas fa-info-circle ml-2"></i>
                    كيفية استخدام السكربت:
                </h4>
                <ol class="list-decimal pr-5 space-y-2 text-sm text-gray-600">
                    <li>انسخ كود السكربت باستخدام زر "نسخ الكل"</li>
                    <li>افتح لعبة Roblox واضغط على زر Windows + R</li>
                    <li>الصق الكود في نافذة التنفيذ (Executor)</li>
                    <li>اضغط على زر التشغيل (Execute/Inject)</li>
                    <li>استمتع بميزات السكربت داخل اللعبة</li>
                </ol>
            </div>
        </div>

        <!-- Related Scripts -->
        <div id="related-scripts" class="glass-card p-6 fade-in hidden">
            <h3 class="text-xl font-bold text-gray-800 mb-4">سكربتات مشابهة</h3>
            <div id="related-scripts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Related scripts will be loaded here -->
                <div class="text-center py-8 col-span-full">
                    <p class="text-gray-400">جارٍ تحميل السكربتات المشابهة...</p>
                </div>
            </div>
        </div>

        <!-- Error Message -->
        <div id="error-message" class="glass-card p-8 text-center hidden">
            <div class="text-red-500 mb-4">
                <i class="fas fa-exclamation-circle text-5xl"></i>
            </div>
            <h3 class="text-xl font-bold text-gray-700 mb-2">عذراً، حدث خطأ</h3>
            <p class="text-gray-600 mb-4">لا يمكن تحميل السكربت المطلوب. قد يكون السكربت غير موجود أو تم حذفه.</p>
            <a href="scripts.html" class="gradient-bg text-white px-6 py-3 rounded-xl font-medium btn-glow inline-flex items-center">
                <i class="fas fa-arrow-left ml-2"></i>
                العودة إلى جميع السكربتات
            </a>
        </div>
    </main>

    <!-- Footer -->
    <footer class="mt-12 pt-8 pb-4 px-4">
        <div class="container mx-auto">
            <div class="glass-card p-6 md:p-8">
                <div class="text-center">
                    <div class="flex items-center justify-center mb-4">
                        <div class="w-10 h-10 rounded-xl overflow-hidden bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center">
                            <i class="fas fa-code text-white"></i>
                        </div>
                        <h2 class="text-xl md:text-2xl font-bold gradient-text mr-3">ScriptBot<span class="text-blue-400">.cloud</span></h2>
                    </div>
                    <p class="text-gray-600 mb-3 text-sm md:text-base">أكبر مكتبة سكربتات وهاكات Roblox مجانية وآمنة.</p>
                    <div class="flex justify-center space-x-3 space-x-reverse mb-4">
                        <a href="https://discord.gg/QnRJdVMaGE" class="w-10 h-10 glass-input rounded-full flex items-center justify-center hover:bg-white transition">
                            <i class="fab fa-discord text-blue-600"></i>
                        </a>
                        <a href="scripts.html" class="w-10 h-10 glass-input rounded-full flex items-center justify-center hover:bg-white transition">
                            <i class="fas fa-code text-blue-600"></i>
                        </a>
                        <a href="Apps.html" class="w-10 h-10 glass-input rounded-full flex items-center justify-center hover:bg-white transition">
                            <i class="fas fa-download text-blue-600"></i>
                        </a>
                    </div>
                    <div class="text-xs text-gray-500">
                        <p class="mb-1">&copy; 2026 ScriptBot.cloud - جميع الحقوق محفوظة</p>
                        <p>هذا الموقع ليس تابعًا لشركة Roblox Corporation. Roblox هي علامة تجارية مسجلة لشركة Roblox Corporation.</p>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Back to Top Button -->
    <button id="back-to-top" class="fixed bottom-4 right-4 md:bottom-6 md:left-6 w-10 h-10 md:w-12 md:h-12 gradient-bg text-white rounded-full shadow-lg flex items-center justify-center hidden z-40 btn-glow">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBoPJbx5v6EkOqxOJkbhzHqIJdAByh79Rg",
            authDomain: "hhhhhh-d4fb8.firebaseapp.com",
            projectId: "hhhhhh-d4fb8",
            storageBucket: "hhhhhh-d4fb8.appspot.com",
            messagingSenderId: "24512338206",
            appId: "1:24512338206:web:dfe045db59bd3434a2110f",
            measurementId: "G-HD4R7GNQ5H"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // DOM Elements
        const loadingOverlay = document.getElementById('loading-overlay');
        const toast = document.getElementById('toast');
        const toastIcon = document.getElementById('toast-icon');
        const toastMessage = document.getElementById('toast-message');
        
        // Main sections
        const scriptHeader = document.getElementById('script-header');
        const codeSection = document.getElementById('code-section');
        const actionButtons = document.getElementById('action-buttons');
        const relatedScripts = document.getElementById('related-scripts');
        const errorMessage = document.getElementById('error-message');
        const interactionSection = document.getElementById('interaction-section');
        
        // Header elements
        const backButton = document.getElementById('back-button');
        const scriptTitle = document.getElementById('script-title');
        const scriptImage = document.getElementById('script-image');
        const scriptImageContainer = document.getElementById('script-image-container');
        const scriptDescription = document.getElementById('script-description');
        const gameName = document.getElementById('game-name');
        const gameBadge = document.getElementById('game-badge');
        const publisherName = document.getElementById('publisher-name');
        const scriptDate = document.getElementById('script-date');
        const scriptBadges = document.getElementById('script-badges');
        const scriptActions = document.getElementById('script-actions');
        const tagsContainer = document.getElementById('tags-container');
        const statsGrid = document.getElementById('stats-grid');
        const warningAlert = document.getElementById('warning-alert');
        
        // Code section elements
        const codeContent = document.getElementById('code-content');
        const codeLength = document.getElementById('code-length');
        const copyAllBtn = document.getElementById('copy-all-btn');
        const toggleCodeBtn = document.getElementById('toggle-code-btn');
        const toggleIcon = document.getElementById('toggle-icon');
        const toggleText = document.getElementById('toggle-text');
        
        // Rating elements
        const ratingStars = document.getElementById('rating-stars');
        const averageRating = document.getElementById('average-rating');
        const totalRatings = document.getElementById('total-ratings');
        const ratingDistribution = document.getElementById('rating-distribution');
        const userRatingSection = document.getElementById('user-rating-section');
        const userRatingIndicator = document.getElementById('user-rating-indicator');
        const userRatingValue = document.getElementById('user-rating-value');
        
        // Like elements
        const likeButton = document.getElementById('like-button');
        const likeIcon = document.getElementById('like-icon');
        const likeText = document.getElementById('like-text');
        const likeCount = document.getElementById('like-count');
        const dislikeButton = document.getElementById('dislike-button');
        const dislikeIcon = document.getElementById('dislike-icon');
        const dislikeCount = document.getElementById('dislike-count');
        
        // Action buttons container
        const actionButtonsContainer = document.getElementById('action-buttons');
        
        // Related scripts
        const relatedScriptsGrid = document.getElementById('related-scripts-grid');
        
        // Back to top button
        const backToTopBtn = document.getElementById('back-to-top');

        // State
        let currentScript = null;
        let scriptContent = '';
        let isCodeExpanded = false;
        let scriptId = null;
        let currentUserId = null;
        let userRating = 0;
        let userLikeStatus = 0; // 0: none, 1: liked, -1: disliked

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initBackButton();
            initBackToTop();
            initCodeToggle();
            initRatingSystem();
            initLikeSystem();
            loadScriptFromURL();
            generateUserId(); // Generate unique user ID for tracking
        });

        // Generate unique user ID for tracking ratings and likes
        function generateUserId() {
            let userId = localStorage.getItem('scriptbot_user_id');
            if (!userId) {
                userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('scriptbot_user_id', userId);
            }
            currentUserId = userId;
        }

        // Back button functionality
        function initBackButton() {
            backButton.addEventListener('click', function() {
                if (document.referrer && document.referrer.includes(window.location.hostname)) {
                    window.history.back();
                } else {
                    window.location.href = 'scripts.html';
                }
            });
        }

        // Load script from URL parameter
        function loadScriptFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            scriptId = urlParams.get('id');
            
            if (!scriptId) {
                showError('لم يتم تحديد معرف السكربت');
                return;
            }
            
            loadScript(scriptId);
        }

        // Load script from Firebase
        async function loadScript(id) {
            try {
                showLoading(true);
                
                const docRef = db.collection('scripts').doc(id);
                const docSnap = await docRef.get();

                if (!docSnap.exists) {
                    showError('السكربت غير موجود');
                    return;
                }

                currentScript = docSnap.data();
                currentScript.id = docSnap.id;
                scriptContent = currentScript.content || '';
                
                // Update views count
                await updateViews(id, currentScript.views || 0);
                
                // Get publisher info if available
                let publisherData = { name: 'غير معروف' };
                if (currentScript.publisher) {
                    const userDoc = await db.collection('users').doc(currentScript.publisher).get();
                    if (userDoc.exists) {
                        publisherData = userDoc.data();
                    }
                }
                
                // Load user interactions
                await loadUserInteractions(id);
                
                // Render script
                renderScript(currentScript, publisherData);
                
                // Load related scripts
                loadRelatedScripts(currentScript.map || currentScript.game);
                
                showLoading(false);
                
            } catch (error) {
                console.error('Error loading script:', error);
                showError('حدث خطأ في تحميل السكربت');
                showLoading(false);
            }
        }

        // Load user interactions (rating and like)
        async function loadUserInteractions(scriptId) {
            try {
                // Get user's rating
                const ratingDoc = await db.collection('ratings')
                    .where('scriptId', '==', scriptId)
                    .where('userId', '==', currentUserId)
                    .limit(1)
                    .get();
                
                if (!ratingDoc.empty) {
                    const ratingData = ratingDoc.docs[0].data();
                    userRating = ratingData.rating || 0;
                }
                
                // Get user's like status
                const likeDoc = await db.collection('likes')
                    .where('scriptId', '==', scriptId)
                    .where('userId', '==', currentUserId)
                    .limit(1)
                    .get();
                
                if (!likeDoc.empty) {
                    const likeData = likeDoc.docs[0].data();
                    userLikeStatus = likeData.status || 0; // 1: liked, -1: disliked, 0: none
                }
                
            } catch (error) {
                console.error('Error loading user interactions:', error);
            }
        }

        // Update views count
        async function updateViews(id, currentViews) {
            try {
                const newViews = (currentViews || 0) + 1;
                await db.collection('scripts').doc(id).update({
                    views: newViews
                });
                return newViews;
            } catch (error) {
                console.error('Error updating views:', error);
                return currentViews || 0;
            }
        }

        // Update downloads count
        async function updateDownloads(id, currentDownloads) {
            try {
                const newDownloads = (currentDownloads || 0) + 1;
                await db.collection('scripts').doc(id).update({
                    downloads: newDownloads
                });
                return newDownloads;
            } catch (error) {
                console.error('Error updating downloads:', error);
                return currentDownloads || 0;
            }
        }

        // Render script
        function renderScript(script, publisherData) {
            // Update title
            document.title = `${script.name} | ScriptBot`;
            scriptTitle.textContent = script.name;
            
            // Update description
            scriptDescription.textContent = script.desc || 'لا يوجد وصف';
            
            // Update game info
            const game = script.map || script.game || 'عام';
            gameName.textContent = game;
            
            // Update publisher
            publisherName.textContent = publisherData.name || 'غير معروف';
            
            // Update date
            const date = script.createdAt?.toDate?.() || new Date(script.date || Date.now());
            scriptDate.textContent = `تاريخ النشر: ${formatDate(date)}`;
            
            // Update image
            if (script.imageUrl) {
                scriptImage.src = script.imageUrl;
                scriptImage.alt = `صورة سكربت ${script.name}`;
            } else {
                scriptImageContainer.innerHTML = `
                    <div class="w-full h-64 bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center">
                        <i class="fas fa-code text-white text-5xl"></i>
                    </div>
                `;
            }
            
            // Create badges
            createBadges(script);
            
            // Create quick actions
            createQuickActions(script);
            
            // Create tags
            createTags(script);
            
            // Create stats
            createStats(script);
            
            // Update code
            updateCodeContent(script);
            
            // Create action buttons
            createActionButtons(script);
            
            // Load and show rating data
            loadRatingData(script.id);
            
            // Update like display
            updateLikeDisplay(script);
            
            // Show sections
            scriptHeader.classList.remove('hidden');
            codeSection.classList.remove('hidden');
            actionButtons.classList.remove('hidden');
            interactionSection.classList.remove('hidden');
            
            // Add fade-in effect
            setTimeout(() => {
                scriptHeader.classList.add('fade-in');
                codeSection.classList.add('fade-in');
                actionButtons.classList.add('fade-in');
                interactionSection.classList.add('fade-in');
            }, 100);
        }

        // Load rating data
        async function loadRatingData(scriptId) {
            try {
                // Get all ratings for this script
                const ratingsSnapshot = await db.collection('ratings')
                    .where('scriptId', '==', scriptId)
                    .get();
                
                let total = 0;
                let sum = 0;
                const distribution = {5: 0, 4: 0, 3: 0, 2: 0, 1: 0};
                
                ratingsSnapshot.forEach(doc => {
                    const rating = doc.data().rating;
                    if (rating >= 1 && rating <= 5) {
                        distribution[rating]++;
                        total++;
                        sum += rating;
                    }
                });
                
                // Calculate average
                const average = total > 0 ? (sum / total).toFixed(1) : '0.0';
                averageRating.textContent = average;
                totalRatings.textContent = total;
                
                // Update user's rating if exists
                if (userRating > 0) {
                    document.querySelector(`#rating-stars input[value="${userRating}"]`).checked = true;
                    userRatingIndicator.classList.remove('hidden');
                    userRatingValue.textContent = userRating;
                }
                
                // Render distribution
                renderRatingDistribution(distribution, total);
                
            } catch (error) {
                console.error('Error loading rating data:', error);
            }
        }

        // Render rating distribution
        function renderRatingDistribution(distribution, total) {
            ratingDistribution.innerHTML = '';
            
            for (let i = 5; i >= 1; i--) {
                const percentage = total > 0 ? (distribution[i] / total * 100) : 0;
                
                const row = document.createElement('div');
                row.className = 'rating-row';
                row.innerHTML = `
                    <div class="rating-star">${i}★</div>
                    <div class="rating-progress flex-1">
                        <div class="rating-progress-bar" style="width: ${percentage}%"></div>
                    </div>
                    <div class="rating-count">${distribution[i]}</div>
                `;
                ratingDistribution.appendChild(row);
            }
        }

        // Update like display
        function updateLikeDisplay(script) {
            const likes = script.likes || 0;
            const dislikes = script.dislikes || 0;
            
            likeCount.textContent = formatNumber(likes);
            dislikeCount.textContent = formatNumber(dislikes);
            
            // Update like button based on user's status
            if (userLikeStatus === 1) {
                likeButton.classList.add('liked');
                likeIcon.className = 'fas fa-heart';
                likeText.textContent = 'أعجبني';
                likeButton.classList.add('like-gradient-bg');
                likeButton.classList.remove('glass-input');
            } else if (userLikeStatus === -1) {
                dislikeIcon.className = 'fas fa-thumbs-down text-red-500';
                dislikeButton.classList.add('bg-red-50');
            } else {
                likeButton.classList.remove('liked');
                likeIcon.className = 'far fa-heart';
                likeText.textContent = 'أعجبني';
                likeButton.classList.remove('like-gradient-bg');
                likeButton.classList.add('glass-input');
                dislikeIcon.className = 'fas fa-thumbs-down';
                dislikeButton.classList.remove('bg-red-50');
            }
        }

        // Initialize rating system
        function initRatingSystem() {
            const starInputs = ratingStars.querySelectorAll('input');
            
            starInputs.forEach(input => {
                input.addEventListener('change', async (e) => {
                    const rating = parseInt(e.target.value);
                    await submitRating(rating);
                });
            });
        }

        // Initialize like system
        function initLikeSystem() {
            likeButton.addEventListener('click', async () => {
                await handleLike();
            });
            
            dislikeButton.addEventListener('click', async () => {
                await handleDislike();
            });
        }

        // Submit rating
        async function submitRating(rating) {
            try {
                if (!currentScript || !scriptId || !currentUserId) {
                    showToast('حدث خطأ في تسجيل التقييم', 'error');
                    return;
                }
                
                // Check if user already rated
                const existingRating = await db.collection('ratings')
                    .where('scriptId', '==', scriptId)
                    .where('userId', '==', currentUserId)
                    .limit(1)
                    .get();
                
                if (!existingRating.empty) {
                    // Update existing rating
                    const ratingId = existingRating.docs[0].id;
                    await db.collection('ratings').doc(ratingId).update({
                        rating: rating,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } else {
                    // Create new rating
                    await db.collection('ratings').add({
                        scriptId: scriptId,
                        userId: currentUserId,
                        rating: rating,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
                
                // Update user's rating locally
                userRating = rating;
                userRatingIndicator.classList.remove('hidden');
                userRatingValue.textContent = rating;
                
                // Update stats in real-time
                await updateRatingStats();
                
                showToast(`شكراً لتقييمك! (${rating} نجوم)`, 'success');
                
            } catch (error) {
                console.error('Error submitting rating:', error);
                showToast('حدث خطأ في تسجيل التقييم', 'error');
            }
        }

        // Update rating stats
        async function updateRatingStats() {
            try {
                // Recalculate average rating
                const ratingsSnapshot = await db.collection('ratings')
                    .where('scriptId', '==', scriptId)
                    .get();
                
                let total = 0;
                let sum = 0;
                const distribution = {5: 0, 4: 0, 3: 0, 2: 0, 1: 0};
                
                ratingsSnapshot.forEach(doc => {
                    const rating = doc.data().rating;
                    if (rating >= 1 && rating <= 5) {
                        distribution[rating]++;
                        total++;
                        sum += rating;
                    }
                });
                
                // Update average
                const average = total > 0 ? (sum / total).toFixed(1) : '0.0';
                averageRating.textContent = average;
                totalRatings.textContent = total;
                
                // Update distribution
                renderRatingDistribution(distribution, total);
                
                // Update stats grid
                const ratingElement = statsGrid.querySelector('.fa-star')?.closest('.glass-card');
                if (ratingElement) {
                    ratingElement.querySelector('.text-2xl').textContent = average;
                }
                
            } catch (error) {
                console.error('Error updating rating stats:', error);
            }
        }

        // Handle like
        async function handleLike() {
            try {
                if (!currentScript || !scriptId || !currentUserId) {
                    showToast('حدث خطأ في تسجيل الإعجاب', 'error');
                    return;
                }
                
                // Check current status
                let newStatus = 1;
                let likeChange = 1;
                
                if (userLikeStatus === 1) {
                    // User already liked, so remove like
                    newStatus = 0;
                    likeChange = -1;
                } else if (userLikeStatus === -1) {
                    // User disliked before, change to like
                    newStatus = 1;
                    likeChange = 2; // Remove dislike (-1) and add like (+1) = +2
                }
                
                // Update like in database
                await updateLikeInDatabase(newStatus);
                
                // Update script likes count
                const currentLikes = currentScript.likes || 0;
                const currentDislikes = currentScript.dislikes || 0;
                
                let newLikes = currentLikes;
                let newDislikes = currentDislikes;
                
                if (userLikeStatus === 1) {
                    // Removing like
                    newLikes = Math.max(0, currentLikes - 1);
                } else if (userLikeStatus === -1) {
                    // Changing from dislike to like
                    newLikes = currentLikes + 1;
                    newDislikes = Math.max(0, currentDislikes - 1);
                } else {
                    // Adding new like
                    newLikes = currentLikes + 1;
                }
                
                // Update Firebase
                await db.collection('scripts').doc(scriptId).update({
                    likes: newLikes,
                    dislikes: newDislikes
                });
                
                // Update local state
                userLikeStatus = newStatus;
                currentScript.likes = newLikes;
                currentScript.dislikes = newDislikes;
                
                // Update display with animation
                likeCount.textContent = formatNumber(newLikes);
                dislikeCount.textContent = formatNumber(newDislikes);
                
                // Animate like count change
                likeCount.classList.add('changed');
                setTimeout(() => likeCount.classList.remove('changed'), 500);
                
                // Update like button
                if (newStatus === 1) {
                    likeButton.classList.add('liked');
                    likeIcon.className = 'fas fa-heart';
                    likeText.textContent = 'أعجبني';
                    likeButton.classList.add('like-gradient-bg');
                    likeButton.classList.remove('glass-input');
                    showToast('شكراً لإعجابك بالسكربت!', 'success');
                } else {
                    likeButton.classList.remove('liked');
                    likeIcon.className = 'far fa-heart';
                    likeText.textContent = 'أعجبني';
                    likeButton.classList.remove('like-gradient-bg');
                    likeButton.classList.add('glass-input');
                    showToast('تم إزالة الإعجاب', 'info');
                }
                
                // Update dislike button if needed
                if (userLikeStatus !== -1) {
                    dislikeIcon.className = 'fas fa-thumbs-down';
                    dislikeButton.classList.remove('bg-red-50');
                }
                
                // Update stats grid
                const likesElement = statsGrid.querySelector('.fa-heart')?.closest('.glass-card');
                if (likesElement) {
                    likesElement.querySelector('.text-2xl').textContent = formatNumber(newLikes);
                }
                
            } catch (error) {
                console.error('Error handling like:', error);
                showToast('حدث خطأ في تسجيل الإعجاب', 'error');
            }
        }

        // Handle dislike
        async function handleDislike() {
            try {
                if (!currentScript || !scriptId || !currentUserId) {
                    showToast('حدث خطأ في تسجيل عدم الإعجاب', 'error');
                    return;
                }
                
                // Check current status
                let newStatus = -1;
                let dislikeChange = 1;
                
                if (userLikeStatus === -1) {
                    // User already disliked, so remove dislike
                    newStatus = 0;
                    dislikeChange = -1;
                } else if (userLikeStatus === 1) {
                    // User liked before, change to dislike
                    newStatus = -1;
                    dislikeChange = 2; // Remove like (-1) and add dislike (+1) = +2
                }
                
                // Update like in database
                await updateLikeInDatabase(newStatus);
                
                // Update script dislikes count
                const currentLikes = currentScript.likes || 0;
                const currentDislikes = currentScript.dislikes || 0;
                
                let newLikes = currentLikes;
                let newDislikes = currentDislikes;
                
                if (userLikeStatus === -1) {
                    // Removing dislike
                    newDislikes = Math.max(0, currentDislikes - 1);
                } else if (userLikeStatus === 1) {
                    // Changing from like to dislike
                    newDislikes = currentDislikes + 1;
                    newLikes = Math.max(0, currentLikes - 1);
                } else {
                    // Adding new dislike
                    newDislikes = currentDislikes + 1;
                }
                
                // Update Firebase
                await db.collection('scripts').doc(scriptId).update({
                    likes: newLikes,
                    dislikes: newDislikes
                });
                
                // Update local state
                userLikeStatus = newStatus;
                currentScript.likes = newLikes;
                currentScript.dislikes = newDislikes;
                
                // Update display
                likeCount.textContent = formatNumber(newLikes);
                dislikeCount.textContent = formatNumber(newDislikes);
                
                // Update dislike button
                if (newStatus === -1) {
                    dislikeIcon.className = 'fas fa-thumbs-down text-red-500';
                    dislikeButton.classList.add('bg-red-50');
                    showToast('تم تسجيل عدم الإعجاب', 'info');
                } else {
                    dislikeIcon.className = 'fas fa-thumbs-down';
                    dislikeButton.classList.remove('bg-red-50');
                }
                
                // Update like button if needed
                if (userLikeStatus !== 1) {
                    likeButton.classList.remove('liked');
                    likeIcon.className = 'far fa-heart';
                    likeText.textContent = 'أعجبني';
                    likeButton.classList.remove('like-gradient-bg');
                    likeButton.classList.add('glass-input');
                }
                
                // Update stats grid
                const likesElement = statsGrid.querySelector('.fa-heart')?.closest('.glass-card');
                if (likesElement) {
                    likesElement.querySelector('.text-2xl').textContent = formatNumber(newLikes);
                }
                
            } catch (error) {
                console.error('Error handling dislike:', error);
                showToast('حدث خطأ في تسجيل عدم الإعجاب', 'error');
            }
        }

        // Update like in database
        async function updateLikeInDatabase(status) {
            try {
                // Check if like entry exists
                const likeQuery = await db.collection('likes')
                    .where('scriptId', '==', scriptId)
                    .where('userId', '==', currentUserId)
                    .limit(1)
                    .get();
                
                if (!likeQuery.empty) {
                    const likeId = likeQuery.docs[0].id;
                    if (status === 0) {
                        // Remove like entry
                        await db.collection('likes').doc(likeId).delete();
                    } else {
                        // Update existing like
                        await db.collection('likes').doc(likeId).update({
                            status: status,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }
                } else if (status !== 0) {
                    // Create new like entry
                    await db.collection('likes').add({
                        scriptId: scriptId,
                        userId: currentUserId,
                        status: status,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
            } catch (error) {
                console.error('Error updating like in database:', error);
                throw error;
            }
        }

        // Create badges
        function createBadges(script) {
            scriptBadges.innerHTML = '';
            
            // New badge
            if (script.isNew || script.status === 'new') {
                const badge = document.createElement('span');
                badge.className = 'script-badge';
                badge.textContent = 'جديد';
                scriptBadges.appendChild(badge);
            }
            
            // Updated badge
            if (script.isUpdated || script.status === 'updated') {
                const badge = document.createElement('span');
                badge.className = 'script-badge';
                badge.style.background = 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)';
                badge.textContent = 'محدث';
                scriptBadges.appendChild(badge);
            }
            
            // Popular badge
            if ((script.downloads || 0) > 1000) {
                const badge = document.createElement('span');
                badge.className = 'script-badge';
                badge.style.background = 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)';
                badge.textContent = 'شائع';
                scriptBadges.appendChild(badge);
            }
        }

        // Create quick actions
        function createQuickActions(script) {
            scriptActions.innerHTML = '';
            
            // Copy button
            const copyBtn = document.createElement('button');
            copyBtn.className = 'glass-input text-blue-600 p-2 rounded-lg hover:bg-white transition';
            copyBtn.innerHTML = '<i class="fas fa-copy"></i>';
            copyBtn.title = 'نسخ السكربت';
            copyBtn.addEventListener('click', copyScriptToClipboard);
            scriptActions.appendChild(copyBtn);
            
            // Download button
            const downloadBtn = document.createElement('button');
            downloadBtn.className = 'glass-input text-blue-600 p-2 rounded-lg hover:bg-white transition';
            downloadBtn.innerHTML = '<i class="fas fa-download"></i>';
            downloadBtn.title = 'تحميل السكربت';
            downloadBtn.addEventListener('click', downloadScript);
            scriptActions.appendChild(downloadBtn);
            
            // Share button
            const shareBtn = document.createElement('button');
            shareBtn.className = 'glass-input text-blue-600 p-2 rounded-lg hover:bg-white transition';
            shareBtn.innerHTML = '<i class="fas fa-share-alt"></i>';
            shareBtn.title = 'مشاركة السكربت';
            shareBtn.addEventListener('click', shareScript);
            scriptActions.appendChild(shareBtn);
        }

        // Create tags
        function createTags(script) {
            const tagsDiv = tagsContainer.querySelector('.flex');
            tagsDiv.innerHTML = '';
            
            // Add game tag
            const gameTag = document.createElement('span');
            gameTag.className = 'script-tag';
            gameTag.textContent = script.map || script.game || 'عام';
            tagsDiv.appendChild(gameTag);
            
            // Add other tags
            if (script.tags && Array.isArray(script.tags)) {
                script.tags.slice(0, 5).forEach(tag => {
                    const tagElement = document.createElement('span');
                    tagElement.className = 'script-tag';
                    tagElement.textContent = tag;
                    tagsDiv.appendChild(tagElement);
                });
            }
            
            // Add type tag if exists
            if (script.type) {
                const typeTag = document.createElement('span');
                typeTag.className = 'script-tag';
                typeTag.textContent = script.type;
                tagsDiv.appendChild(typeTag);
            }
        }

        // Create stats
        function createStats(script) {
            statsGrid.innerHTML = '';
            
            const stats = [
                {
                    icon: 'fa-eye',
                    label: 'مشاهدات',
                    value: formatNumber(script.views || 0),
                    color: 'text-blue-600',
                    bg: 'bg-blue-100/50'
                },
                {
                    icon: 'fa-download',
                    label: 'تحميلات',
                    value: formatNumber(script.downloads || 0),
                    color: 'text-green-600',
                    bg: 'bg-green-100/50'
                },
                {
                    icon: 'fa-heart',
                    label: 'إعجابات',
                    value: formatNumber(script.likes || 0),
                    color: 'text-red-600',
                    bg: 'bg-red-100/50'
                },
                {
                    icon: 'fa-star',
                    label: 'تقييم',
                    value: script.rating ? `${script.rating}/5` : 'غير مقيم',
                    color: 'text-yellow-600',
                    bg: 'bg-yellow-100/50'
                }
            ];
            
            stats.forEach(stat => {
                const statElement = document.createElement('div');
                statElement.className = 'glass-card p-4 text-center';
                statElement.innerHTML = `
                    <div class="${stat.bg} w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-2">
                        <i class="fas ${stat.icon} ${stat.color} text-lg"></i>
                    </div>
                    <div class="text-2xl font-bold text-gray-800 mb-1">${stat.value}</div>
                    <div class="text-sm text-gray-600">${stat.label}</div>
                `;
                statsGrid.appendChild(statElement);
            });
        }

        // Update code content
        function updateCodeContent(script) {
            if (script.content) {
                codeContent.textContent = script.content;
                codeLength.textContent = `(${formatNumber(script.content.length)} حرف)`;
                
                // Add syntax highlighting for common keywords
                highlightCode();
            } else {
                codeContent.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-exclamation-triangle text-gray-400 text-3xl mb-3"></i>
                        <p class="text-gray-400">لا يوجد كود متاح لهذا السكربت</p>
                    </div>
                `;
                codeLength.textContent = '(لا يوجد كود)';
            }
        }

        // Simple syntax highlighting
        function highlightCode() {
            const code = codeContent.textContent;
            
            // Common Lua/Roblox keywords
            const keywords = [
                'local', 'function', 'end', 'if', 'then', 'else', 'elseif',
                'for', 'while', 'do', 'repeat', 'until', 'in', 'return',
                'break', 'nil', 'true', 'false', 'not', 'and', 'or',
                'game', 'workspace', 'players', 'player', 'character',
                'wait', 'print', 'warn', 'error'
            ];
            
            let highlighted = code;
            
            keywords.forEach(keyword => {
                const regex = new RegExp(`\\b(${keyword})\\b`, 'gi');
                highlighted = highlighted.replace(regex, `<span class="text-blue-400 font-semibold">$1</span>`);
            });
            
            // Highlight strings
            highlighted = highlighted.replace(/("[^"]*"|'[^']*')/g, '<span class="text-green-400">$1</span>');
            
            // Highlight numbers
            highlighted = highlighted.replace(/\b(\d+\.?\d*)\b/g, '<span class="text-yellow-400">$1</span>');
            
            // Highlight comments
            highlighted = highlighted.replace(/--[^\n]*/g, '<span class="text-gray-500">$&</span>');
            
            codeContent.innerHTML = highlighted;
        }

        // Create action buttons
        function createActionButtons(script) {
            const container = actionButtonsContainer.querySelector('.grid');
            container.innerHTML = '';
            
            const buttons = [
                {
                    id: 'copy-btn',
                    icon: 'fa-copy',
                    text: 'نسخ الكل',
                    color: 'success-gradient-bg btn-success-glow',
                    action: copyScriptToClipboard
                },
                {
                    id: 'download-btn',
                    icon: 'fa-download',
                    text: 'تحميل ملف',
                    color: 'gradient-bg btn-glow',
                    action: downloadScript
                },
                {
                    id: 'execute-btn',
                    icon: 'fa-play',
                    text: 'تعليمات التشغيل',
                    color: 'secondary-gradient-bg btn-glow',
                    action: showInstructions
                },
                {
                    id: 'discord-btn',
                    icon: 'fab fa-discord',
                    text: 'الدعم على Discord',
                    color: 'warning-gradient-bg btn-warning-glow',
                    action: openDiscord
                }
            ];
            
            buttons.forEach(btn => {
                const button = document.createElement('button');
                button.id = btn.id;
                button.className = `${btn.color} text-white p-4 rounded-xl font-medium flex flex-col items-center justify-center action-button`;
                button.innerHTML = `
                    <i class="${btn.icon} text-2xl mb-2"></i>
                    <span class="text-sm font-medium">${btn.text}</span>
                `;
                button.addEventListener('click', btn.action);
                container.appendChild(button);
            });
        }

        // Load related scripts
        async function loadRelatedScripts(gameName) {
            try {
                if (!gameName || gameName === 'عام') {
                    relatedScripts.classList.add('hidden');
                    return;
                }
                
                const querySnapshot = await db.collection('scripts')
                    .where('map', '==', gameName)
                    .limit(3)
                    .get();
                
                if (querySnapshot.empty) {
                    relatedScripts.classList.add('hidden');
                    return;
                }
                
                relatedScriptsGrid.innerHTML = '';
                let hasRelated = false;
                
                querySnapshot.forEach(doc => {
                    const script = doc.data();
                    script.id = doc.id;
                    
                    // Don't show current script in related
                    if (script.id === currentScript.id) return;
                    
                    hasRelated = true;
                    
                    const card = document.createElement('div');
                    card.className = 'glass-card p-4 hover:shadow-xl transition cursor-pointer';
                    card.addEventListener('click', () => {
                        window.location.href = `script-view.html?id=${script.id}`;
                    });
                    
                    card.innerHTML = `
                        <div class="flex items-start justify-between mb-3">
                            <h4 class="font-bold text-gray-800 line-clamp-1">${script.name}</h4>
                            <span class="text-xs text-gray-500">${formatDate(script.createdAt?.toDate?.() || new Date(script.date || Date.now()))}</span>
                        </div>
                        <p class="text-gray-600 text-sm line-clamp-2 mb-3">${script.desc || 'لا يوجد وصف'}</p>
                        <div class="flex justify-between items-center text-sm text-gray-500">
                            <span class="flex items-center">
                                <i class="fas fa-eye ml-1"></i>
                                <span>${formatNumber(script.views || 0)}</span>
                            </span>
                            <span class="flex items-center">
                                <i class="fas fa-download ml-1"></i>
                                <span>${formatNumber(script.downloads || 0)}</span>
                            </span>
                        </div>
                    `;
                    
                    relatedScriptsGrid.appendChild(card);
                });
                
                if (hasRelated) {
                    relatedScripts.classList.remove('hidden');
                    relatedScripts.classList.add('fade-in');
                } else {
                    relatedScripts.classList.add('hidden');
                }
                
            } catch (error) {
                console.error('Error loading related scripts:', error);
                relatedScripts.classList.add('hidden');
            }
        }

        // Copy script to clipboard
        async function copyScriptToClipboard() {
            try {
                if (!scriptContent) {
                    showToast('لا يوجد كود لنسخه', 'error');
                    return;
                }
                
                await navigator.clipboard.writeText(scriptContent);
                showToast('تم نسخ السكربت بنجاح!', 'success');
                
                // Add animation effect to copy button
                const copyBtn = document.getElementById('copy-btn');
                if (copyBtn) {
                    copyBtn.classList.add('copy-success');
                    setTimeout(() => copyBtn.classList.remove('copy-success'), 300);
                }
                
            } catch (error) {
                console.error('Error copying text:', error);
                showToast('حدث خطأ أثناء النسخ', 'error');
            }
        }

        // Download script
        async function downloadScript() {
            try {
                if (!scriptContent) {
                    showToast('لا يوجد كود لتحميله', 'error');
                    return;
                }
                
                const blob = new Blob([scriptContent], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${currentScript.name.replace(/[^\w\s]/gi, '')}.lua`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                // Update downloads count
                const newDownloads = await updateDownloads(currentScript.id, currentScript.downloads || 0);
                
                // Update stats display
                const downloadsElement = statsGrid.querySelector('.fa-download')?.closest('.glass-card');
                if (downloadsElement) {
                    downloadsElement.querySelector('.text-2xl').textContent = formatNumber(newDownloads);
                }
                
                showToast('تم تحميل السكربت بنجاح!', 'success');
                
            } catch (error) {
                console.error('Error downloading file:', error);
                showToast('حدث خطأ أثناء التحميل', 'error');
            }
        }

        // Show instructions
        function showInstructions() {
            showToast('انظر قسم "كيفية استخدام السكربت" أدناه', 'info');
            
            // Scroll to instructions
            const instructions = document.querySelector('.mt-8.p-4');
            if (instructions) {
                instructions.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Open Discord
        function openDiscord() {
            window.open('https://discord.gg/hema1', '_blank');
        }

        // Share script
        function shareScript() {
            if (navigator.share) {
                navigator.share({
                    title: currentScript.name,
                    text: `تحقق من سكربت ${currentScript.name} على ScriptBot`,
                    url: window.location.href,
                })
                .catch(error => console.log('Error sharing:', error));
            } else {
                // Fallback: copy URL to clipboard
                navigator.clipboard.writeText(window.location.href)
                    .then(() => showToast('تم نسخ رابط المشاركة', 'success'))
                    .catch(() => showToast('حدث خطأ في المشاركة', 'error'));
            }
        }

        // Initialize code toggle
        function initCodeToggle() {
            toggleCodeBtn.addEventListener('click', function() {
                isCodeExpanded = !isCodeExpanded;
                
                if (isCodeExpanded) {
                    codeContent.style.maxHeight = 'none';
                    toggleIcon.className = 'fas fa-compress ml-1';
                    toggleText.textContent = 'تصغير';
                } else {
                    codeContent.style.maxHeight = '400px';
                    toggleIcon.className = 'fas fa-expand ml-1';
                    toggleText.textContent = 'تكبير';
                }
            });
            
            // Also handle copy all button
            copyAllBtn.addEventListener('click', copyScriptToClipboard);
        }

        // Initialize back to top
        function initBackToTop() {
            window.addEventListener('scroll', () => {
                if (window.pageYOffset > 300) {
                    backToTopBtn.classList.remove('hidden');
                } else {
                    backToTopBtn.classList.add('hidden');
                }
            });
            
            backToTopBtn.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        }

        // Show loading overlay
        function showLoading(show) {
            if (show) {
                loadingOverlay.style.display = 'flex';
            } else {
                loadingOverlay.style.display = 'none';
            }
        }

        // Show error message
        function showError(message) {
            errorMessage.classList.remove('hidden');
            errorMessage.querySelector('p').textContent = message;
            showLoading(false);
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            // Update toast content
            toastMessage.textContent = message;
            
            // Update icon based on type
            const icons = {
                success: 'fa-check-circle text-green-500',
                error: 'fa-times-circle text-red-500',
                warning: 'fa-exclamation-triangle text-yellow-500',
                info: 'fa-info-circle text-blue-500'
            };
            
            toastIcon.className = `fas ${icons[type] || icons.success}`;
            toast.className = `toast glass-card ${type}`;
            
            // Show toast
            toast.classList.add('show');
            
            // Hide after 3 seconds
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Helper functions
        function formatDate(date) {
            if (!date) return 'غير معروف';
            
            try {
                const d = new Date(date);
                return d.toLocaleDateString('ar-EG', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
            } catch (e) {
                return 'غير معروف';
            }
        }

        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }

        // Touch device optimizations
        if ('ontouchstart' in window) {
            document.body.classList.add('touch-device');
            
            // Increase tap target sizes for mobile
            document.querySelectorAll('button, a').forEach(el => {
                if (el.offsetWidth < 44 || el.offsetHeight < 44) {
                    el.style.minHeight = '44px';
                    el.style.minWidth = '44px';
                }
            });
        }
    </script>
</body>
</html>
