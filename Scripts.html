<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <script type="module" src="notification.js"></script>
    <script type="module" src="maintenance-check.js"></script>

    <meta charset="UTF-8" />
    <title>جميع سكربتات Roblox | ScriptBot - المكتبة الشاملة</title>
    <meta name="description" content="أكبر مكتبة سكربتات Roblox مجانية. Blox Fruits, Da Hood, Pet Simulator X. روابط مباشرة ومحدثة يومياً." />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes" />
    
    <meta property="og:title" content="جميع سكربتات Roblox | ScriptBot" />
    <meta property="og:description" content="حمل أفضل سكربتات روبلوكس مجاناً وبأمان." />
    <meta property="og:type" content="website" />
    
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    
    <script src="https://publisher.linkvertise.com/cdn/linkvertise.js"></script>
    <script>
        // تهيئة Linkvertise (تأكد من أن المعرف 1264869 صحيح)
        linkvertise(1264869, {
            whitelist: [],
            blacklist: ["scriptbot.cloud", "localhost"]
        });
    </script>

    <style>
        /* Custom Styles & Glassmorphism */
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #f0f4ff 0%, #e6f0ff 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Background Pattern */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(102, 126, 234, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(118, 75, 162, 0.05) 0%, transparent 50%);
            z-index: -1;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            border-radius: 20px;
        }
        
        .glass-input {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(209, 213, 219, 0.5);
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.02);
        }
        
        .gradient-text {
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .gradient-bg {
            background: var(--primary-gradient);
        }
        
        .btn-glow:hover {
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            transform: translateY(-2px);
            transition: all 0.3s ease;
        }

        .highlight {
            background-color: #fef3c7;
            color: #d97706;
            padding: 0 2px;
            border-radius: 2px;
        }

        /* Mobile Menu Animation */
        .mobile-menu {
            transform: translateX(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .mobile-menu.active { transform: translateX(0); }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.4s ease-out forwards; opacity: 0; }
        
        @keyframes spin-slow { to { transform: rotate(360deg); } }
        .spin-slow { animation: spin-slow 3s linear infinite; }
    </style>
</head>
<body class="text-gray-800">

    <header class="sticky top-0 z-50 px-4 py-3">
        <div class="container mx-auto">
            <div class="glass-card px-4 py-3 flex justify-between items-center">
                <a href="index.html" class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white shadow-lg">
                        <i class="fas fa-code text-lg"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold gradient-text leading-tight">ScriptBot</h1>
                        <p class="text-[10px] text-gray-500 font-semibold">أفضل مكتبة سكربتات</p>
                    </div>
                </a>

                <div class="hidden md:flex items-center gap-4">
                    <div class="relative group">
                        <input id="search-input" type="text" placeholder="بحث سريع..." 
                               class="glass-input pl-10 pr-4 py-2 rounded-xl w-64 focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition-all">
                        <i class="fas fa-search absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 group-focus-within:text-blue-500"></i>
                    </div>
                    <a href="index.html" class="px-4 py-2 rounded-xl hover:bg-white/50 transition text-blue-700 font-medium"><i class="fas fa-home ml-2"></i>الرئيسية</a>
                    <a href="Apps.html" class="px-4 py-2 rounded-xl hover:bg-white/50 transition text-purple-700 font-medium"><i class="fas fa-mobile-alt ml-2"></i>التطبيقات</a>
                </div>

                <button id="mobile-menu-btn" class="md:hidden w-10 h-10 flex items-center justify-center rounded-xl bg-white/50 backdrop-blur text-gray-700">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
        </div>
    </header>

    <div id="menu-overlay" class="fixed inset-0 bg-black/40 z-40 hidden backdrop-blur-sm transition-opacity"></div>
    <div id="mobile-menu" class="mobile-menu fixed top-0 right-0 w-[280px] h-full bg-white/95 backdrop-blur-xl z-50 shadow-2xl p-6">
        <div class="flex justify-between items-center mb-8">
            <h2 class="text-xl font-bold gradient-text">القائمة</h2>
            <button id="close-menu" class="w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 text-gray-600">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="relative mb-6">
            <input id="mobile-search-input" type="text" placeholder="ابحث هنا..." class="w-full glass-input pl-10 pr-4 py-3 rounded-xl">
            <i class="fas fa-search absolute right-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
        </div>
        <nav class="space-y-2">
            <a href="index.html" class="flex items-center p-3 rounded-xl hover:bg-blue-50 text-gray-700 font-medium transition"><i class="fas fa-home ml-3 w-6 text-center text-blue-500"></i>الرئيسية</a>
            <a href="scripts.html" class="flex items-center p-3 rounded-xl bg-gradient-to-r from-blue-500 to-purple-600 text-white font-bold shadow-lg"><i class="fas fa-code ml-3 w-6 text-center"></i>السكربتات</a>
            <a href="Apps.html" class="flex items-center p-3 rounded-xl hover:bg-purple-50 text-gray-700 font-medium transition"><i class="fas fa-download ml-3 w-6 text-center text-purple-500"></i>التطبيقات</a>
            <a href="https://discord.gg/hema1" class="flex items-center p-3 rounded-xl bg-indigo-50 text-indigo-600 font-medium mt-6"><i class="fab fa-discord ml-3 w-6 text-center"></i>سيرفر الديسكورد</a>
        </nav>
    </div>

    <section class="container mx-auto px-4 mt-6 mb-8">
        <div class="grid grid-cols-3 gap-3 md:gap-6">
            <div class="glass-card p-4 text-center">
                <div class="text-2xl md:text-3xl font-bold text-blue-600" id="total-scripts-count">...</div>
                <div class="text-xs md:text-sm text-gray-500">سكربت</div>
            </div>
            <div class="glass-card p-4 text-center">
                <div class="text-2xl md:text-3xl font-bold text-purple-600" id="total-games-count">...</div>
                <div class="text-xs md:text-sm text-gray-500">لعبة</div>
            </div>
            <div class="glass-card p-4 text-center">
                <div class="text-2xl md:text-3xl font-bold text-pink-600" id="total-downloads-count">...</div>
                <div class="text-xs md:text-sm text-gray-500">تحميل</div>
            </div>
        </div>
    </section>

    <main class="flex-1 container mx-auto px-4 pb-12">
        <div class="glass-card p-4 md:p-6 mb-6 sticky top-20 z-30">
            <div class="flex flex-col md:flex-row gap-4 justify-between">
                <div class="relative flex-1">
                    <input id="main-search-input" type="text" placeholder="ابحث باسم السكربت أو اللعبة..." 
                           class="w-full glass-input pl-10 pr-4 py-3 rounded-xl focus:ring-2 focus:ring-blue-500/50 outline-none">
                    <i class="fas fa-search absolute right-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                    <button id="clear-search" class="hidden absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-red-500"><i class="fas fa-times-circle"></i></button>
                </div>
                <div class="flex gap-2 overflow-x-auto pb-1 md:pb-0 no-scrollbar">
                    <select id="filter-game" class="glass-input px-4 py-3 rounded-xl outline-none cursor-pointer min-w-[140px]">
                        <option value="all">كل الألعاب</option>
                    </select>
                    <select id="filter-sort" class="glass-input px-4 py-3 rounded-xl outline-none cursor-pointer min-w-[140px]">
                        <option value="newest">الأحدث</option>
                        <option value="popular">الأشهر</option>
                        <option value="downloads">الأكثر تحميلاً</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="flex justify-between items-center mb-4 px-2">
            <h2 class="text-lg font-bold text-gray-700" id="results-header">أحدث السكربتات</h2>
            <span class="text-sm text-gray-500 bg-white px-3 py-1 rounded-full shadow-sm" id="visible-count-badge">0 / 0</span>
        </div>

        <div id="loading-indicator" class="text-center py-20">
            <div class="w-12 h-12 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin mx-auto mb-4"></div>
            <p class="text-gray-500 animate-pulse">جاري جلب السكربتات...</p>
        </div>

        <div id="scripts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
            </div>

        <div id="no-results" class="hidden text-center py-16">
            <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4 text-gray-400 text-3xl">
                <i class="fas fa-search-minus"></i>
            </div>
            <h3 class="text-lg font-bold text-gray-700">لم يتم العثور على نتائج</h3>
            <p class="text-gray-500 mb-6">جرب البحث بكلمات أخرى</p>
            <button onclick="resetAllFilters()" class="text-blue-600 font-medium hover:underline">إعادة تعيين الفلاتر</button>
        </div>

        <div class="text-center mt-10">
            <button id="load-more" class="hidden glass-input px-8 py-3 rounded-xl text-blue-600 font-bold hover:bg-white hover:shadow-lg transition">
                عرض المزيد <i class="fas fa-chevron-down mr-2"></i>
            </button>
        </div>
    </main>

    <footer class="bg-white/80 backdrop-blur-lg border-t border-gray-200 mt-auto">
        <div class="container mx-auto px-4 py-8 text-center md:text-right">
            <div class="flex flex-col md:flex-row justify-between items-center gap-6">
                <div>
                    <h3 class="text-xl font-bold gradient-text mb-2">ScriptBot.cloud</h3>
                    <p class="text-sm text-gray-500 max-w-xs">نحن نقدم أفضل السكربتات الآمنة لمجتمع Roblox العربي.</p>
                </div>
                <div class="flex gap-4">
                    <a href="https://discord.gg/hema1" class="w-10 h-10 rounded-full bg-indigo-50 flex items-center justify-center text-indigo-600 hover:bg-indigo-600 hover:text-white transition"><i class="fab fa-discord"></i></a>
                    <a href="#" class="w-10 h-10 rounded-full bg-blue-50 flex items-center justify-center text-blue-600 hover:bg-blue-600 hover:text-white transition"><i class="fab fa-telegram"></i></a>
                </div>
            </div>
            <div class="mt-8 pt-6 border-t border-gray-100 text-xs text-gray-400 flex flex-col md:flex-row justify-between items-center">
                <p>&copy; 2025 ScriptBot. جميع الحقوق محفوظة.</p>
                <div class="flex gap-4 mt-2 md:mt-0">
                    <a href="privacy.txt" class="hover:text-blue-500">الخصوصية</a>
                    <a href="about.txt" class="hover:text-blue-500">من نحن</a>
                </div>
            </div>
        </div>
    </footer>

    <button id="back-to-top" class="fixed bottom-6 right-6 w-12 h-12 gradient-bg text-white rounded-full shadow-xl flex items-center justify-center transform translate-y-20 transition-all duration-300 z-40 hover:scale-110">
        <i class="fas fa-arrow-up"></i>
    </button>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <script>
        // --- إعدادات Firebase ---
        const firebaseConfig = {
            apiKey: "AIzaSyBoPJbx5v6EkOqxOJkbhzHqIJdAByh79Rg", 
            authDomain: "hhhhhh-d4fb8.firebaseapp.com",
            projectId: "hhhhhh-d4fb8",
            storageBucket: "hhhhhh-d4fb8.appspot.com",
            messagingSenderId: "24512338206",
            appId: "1:24512338206:web:dfe045db59bd3434a2110f",
            measurementId: "G-HD4R7GNQ5H"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // --- Linkvertise Settings ---
        // معرف الحساب الخاص بك في Linkvertise
        const LINKVERTISE_USER_ID = "1264869"; 

        // --- DOM Elements ---
        const els = {
            grid: document.getElementById('scripts-grid'),
            loading: document.getElementById('loading-indicator'),
            noResults: document.getElementById('no-results'),
            loadMoreBtn: document.getElementById('load-more'),
            totalScripts: document.getElementById('total-scripts-count'),
            totalGames: document.getElementById('total-games-count'),
            totalDownloads: document.getElementById('total-downloads-count'),
            inputs: {
                search: [
                    document.getElementById('search-input'), 
                    document.getElementById('mobile-search-input'), 
                    document.getElementById('main-search-input')
                ],
                filterGame: document.getElementById('filter-game'),
                filterSort: document.getElementById('filter-sort'),
                clearSearch: document.getElementById('clear-search')
            },
            stats: {
                header: document.getElementById('results-header'),
                badge: document.getElementById('visible-count-badge')
            }
        };

        // --- State ---
        let state = {
            allScripts: [],
            filtered: [],
            games: new Set(),
            page: 1,
            perPage: 12,
            search: '',
            gameFilter: 'all',
            sort: 'newest'
        };

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            initMobileMenu();
            initSearch();
            initFilters();
            fetchData();
            initBackToTop();
        });

        // --- Linkvertise Dynamic Link Generator ---
        // هذه الدالة هي القلب النابض للربح، تقوم بتحويل أي رابط إلى رابط Linkvertise مشفر
        function getLinkvertiseLink(targetUrl) {
            if (!targetUrl) return "#";
            try {
                // تشفير الرابط إلى Base64
                const base64Url = btoa(encodeURIComponent(targetUrl).replace(/%([0-9A-F]{2})/g,
                    function toSolidBytes(match, p1) {
                        return String.fromCharCode('0x' + p1);
                    }));
                
                // تكوين الرابط الديناميكي
                // هذا الرابط يجبر الزائر على المرور عبر Linkvertise قبل الوصول للرابط المشفر
                return `https://link-to.net/${LINKVERTISE_USER_ID}/${Math.random() * 1000}/dynamic?r=${base64Url}`;
            } catch (e) {
                console.error("Link encoding error:", e);
                return targetUrl;
            }
        }

        // --- Data Fetching ---
        async function fetchData() {
            try {
                const snapshot = await db.collection('scripts').get();
                let downloads = 0;
                
                state.allScripts = snapshot.docs.map(doc => {
                    const data = doc.data();
                    if (data.map) state.games.add(data.map);
                    downloads += (data.downloads || 0);
                    return {
                        id: doc.id,
                        ...data,
                        createdAt: data.createdAt?.toDate ? data.createdAt.toDate() : new Date(data.createdAt || 0)
                    };
                });

                // Update Stats
                els.totalScripts.innerText = state.allScripts.length;
                els.totalGames.innerText = state.games.size;
                els.totalDownloads.innerText = formatNumber(downloads);

                // Populate Game Filter
                updateGameDropdown();

                // Initial Render
                applyFilters();

            } catch (err) {
                console.error(err);
                els.grid.innerHTML = `<p class="col-span-full text-center text-red-500">حدث خطأ أثناء تحميل البيانات</p>`;
            } finally {
                els.loading.classList.add('hidden');
            }
        }

        // --- Filtering & Logic ---
        function applyFilters() {
            state.page = 1;
            const term = state.search.toLowerCase();
            
            state.filtered = state.allScripts.filter(s => {
                const matchesSearch = !term || (s.name || '').toLowerCase().includes(term) || (s.map || '').toLowerCase().includes(term);
                const matchesGame = state.gameFilter === 'all' || s.map === state.gameFilter;
                return matchesSearch && matchesGame;
            });

            // Sorting
            state.filtered.sort((a, b) => {
                if (state.sort === 'popular') return (b.views || 0) - (a.views || 0);
                if (state.sort === 'downloads') return (b.downloads || 0) - (a.downloads || 0);
                return b.createdAt - a.createdAt; // newest default
            });

            updateUI();
        }

        function updateUI() {
            els.grid.innerHTML = '';
            
            if (state.filtered.length === 0) {
                els.noResults.classList.remove('hidden');
                els.loadMoreBtn.classList.add('hidden');
                els.stats.badge.innerText = `0 / ${state.allScripts.length}`;
                return;
            }

            els.noResults.classList.add('hidden');
            renderCards();
        }

        function renderCards() {
            const start = 0;
            const end = state.page * state.perPage;
            const slice = state.filtered.slice(start, end);

            els.grid.innerHTML = ''; // Clear and redraw for simplicity (or append if optimized)
            slice.forEach((script, i) => {
                const card = createCard(script);
                card.style.animationDelay = `${i * 0.05}s`;
                els.grid.appendChild(card);
            });

            els.stats.badge.innerText = `${slice.length} / ${state.filtered.length}`;
            
            if (state.filtered.length > end) els.loadMoreBtn.classList.remove('hidden');
            else els.loadMoreBtn.classList.add('hidden');
        }

        function createCard(script) {
            const div = document.createElement('div');
            div.className = 'glass-card p-5 hover:shadow-2xl transition-all duration-300 relative group fade-in flex flex-col h-full';
            
            // تحديد الرابط الأصلي
            const rawUrl = script.downloadUrl || script.url || script.linkvertiseUrl;
            // تحويله لرابط Linkvertise
            const monetizedLink = getLinkvertiseLink(rawUrl);

            div.innerHTML = `
                <div class="absolute top-4 left-4 bg-gray-100 text-gray-600 text-xs px-2 py-1 rounded-md font-bold z-10">
                    ${escapeHtml(script.map || 'عام')}
                </div>
                <div class="mt-6 mb-3 flex-1">
                    <h3 class="text-lg font-bold text-gray-800 mb-2 leading-tight group-hover:text-blue-600 transition">
                        ${highlightText(script.name, state.search)}
                    </h3>
                    <p class="text-gray-500 text-sm line-clamp-2">
                        ${highlightText(script.description || 'لا يوجد وصف', state.search)}
                    </p>
                </div>
                <div class="flex items-center justify-between pt-4 border-t border-gray-100 mt-auto">
                    <div class="flex gap-3 text-xs text-gray-400 font-semibold">
                        <span><i class="fas fa-eye ml-1"></i>${formatNumber(script.views)}</span>
                        <span><i class="fas fa-download ml-1"></i>${formatNumber(script.downloads)}</span>
                    </div>
                    
                    <a href="${monetizedLink}" 
                       target="_blank" 
                       class="download-track-btn gradient-bg text-white px-4 py-2 rounded-lg text-sm font-bold shadow-lg btn-glow flex items-center gap-2 decoration-none"
                       data-id="${script.id}">
                        <i class="fas fa-download"></i> تحميل
                    </a>
                </div>
            `;

            // إضافة حدث لتحديث العداد عند الضغط
            const btn = div.querySelector('.download-track-btn');
            btn.addEventListener('click', (e) => {
                // نترك الرابط يعمل (يفتح نافذة جديدة) ونحدث العداد في الخلفية
                db.collection('scripts').doc(script.id).update({
                    downloads: firebase.firestore.FieldValue.increment(1)
                });
            });

            // عند الضغط على باقي البطاقة نفتح التفاصيل
            div.addEventListener('click', (e) => {
                if(!e.target.closest('a')) {
                    window.location.href = `script-view.html?id=${script.id}`;
                }
            });

            return div;
        }

        // --- Helpers ---
        function updateGameDropdown() {
            const sorted = Array.from(state.games).sort();
            els.inputs.filterGame.innerHTML = '<option value="all">كل الألعاب</option>';
            sorted.forEach(g => {
                els.inputs.filterGame.innerHTML += `<option value="${g}">${g}</option>`;
            });
        }

        function initSearch() {
            els.inputs.search.forEach(inp => {
                inp.addEventListener('input', (e) => {
                    state.search = e.target.value;
                    // Sync inputs
                    els.inputs.search.forEach(i => i !== e.target ? i.value = e.target.value : null);
                    
                    if(state.search) els.inputs.clearSearch.classList.remove('hidden');
                    else els.inputs.clearSearch.classList.add('hidden');
                    
                    applyFilters();
                });
            });
            els.inputs.clearSearch.addEventListener('click', resetAllFilters);
        }

        function initFilters() {
            els.inputs.filterGame.addEventListener('change', (e) => {
                state.gameFilter = e.target.value;
                applyFilters();
            });
            els.inputs.filterSort.addEventListener('change', (e) => {
                state.sort = e.target.value;
                applyFilters();
            });
            els.loadMoreBtn.addEventListener('click', () => {
                state.page++;
                renderCards();
            });
        }

        function resetAllFilters() {
            state.search = '';
            state.gameFilter = 'all';
            state.sort = 'newest';
            els.inputs.search.forEach(i => i.value = '');
            els.inputs.filterGame.value = 'all';
            els.inputs.filterSort.value = 'newest';
            els.inputs.clearSearch.classList.add('hidden');
            applyFilters();
        }

        // UI Utilities
        function initMobileMenu() {
            const btn = document.getElementById('mobile-menu-btn');
            const menu = document.getElementById('mobile-menu');
            const overlay = document.getElementById('menu-overlay');
            const close = document.getElementById('close-menu');

            const toggle = () => {
                menu.classList.toggle('active');
                overlay.classList.toggle('hidden');
                document.body.style.overflow = menu.classList.contains('active') ? 'hidden' : 'auto';
            };

            btn.addEventListener('click', toggle);
            close.addEventListener('click', toggle);
            overlay.addEventListener('click', toggle);
        }

        function initBackToTop() {
            const btn = document.getElementById('back-to-top');
            window.addEventListener('scroll', () => {
                if (window.scrollY > 300) btn.style.transform = 'translateY(0)';
                else btn.style.transform = 'translateY(100px)';
            });
            btn.addEventListener('click', () => window.scrollTo({top: 0, behavior: 'smooth'}));
        }

        function escapeHtml(text) {
            return (text || '').replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
        }

        function highlightText(text, term) {
            const safe = escapeHtml(text);
            if (!term) return safe;
            const re = new RegExp(`(${term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
            return safe.replace(re, '<span class="highlight">$1</span>');
        }

        function formatNumber(num) {
            if (!num) return '0';
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }
    </script>
</body>
</html>
